<mat-card>
  <span class="card-title-back" [style.backgroundColor]="primaryColor"></span>
  <mat-card-title>
    <ng-container *ngIf="players">Lista Giocatori</ng-container>
  </mat-card-title>
  <mat-card-content>
    <div class="card-content-header">
      <div id="header">
        <mat-form-field
          appearance="fill"
          id="filter"
          *ngIf="dataSource.filteredData.length"
        >
          <mat-label>Cerca</mat-label>
          <input matInput (keyup)="applyFilter($event)" />
        </mat-form-field>
      </div>
      <mat-paginator
        fxFlex="grow"
        #paginatorU
        [pageSizeOptions]="[5, 10, 20, 30, 50]"
        [pageSize]="20"
        showFirstLastButtons
      ></mat-paginator>
    </div>

    <mat-table [dataSource]="dataSource" matSort multiTemplateDataRows>
      <ng-container
        [matColumnDef]="col"
        *ngFor="let col of displayedColumns; let i = index"
      >
        <mat-header-cell *matHeaderCellDef mat-sort-header>
          {{ displayedHeaderColumns[i] }}</mat-header-cell
        >
        <mat-cell *matCellDef="let element"
          ><ng-container
            *ngIf="
              col != 'achievementsUnlocked';
              else achievementsUnlockedCellTemplate
            "
            >{{ element[col] }}</ng-container
          ></mat-cell
        >
      </ng-container>
      <ng-container matColumnDef="expandedDetail">
        <mat-cell
          *matCellDef="let element"
          [attr.colspan]="displayedColumns.length"
        >
          <div
            class="element-detail"
            [@detailExpand]="
              element == expandedElement ? 'expanded' : 'collapsed'
            "
            [style.height]="
              element == expandedElement ? 'unset' : '0 !important'
            "
          >
            <div *ngIf="players" class="player-detail">
              <span class="player-catch-phrase-title">Frase d'effetto:</span>
              <span class="player-catch-phrase-desc"
                >“ {{ element.CatchPhrase }} „</span
              >
            </div>
            <div *ngIf="achievements" class="player-achievements">
              <div class="achievements-list-title">Obbiettivi</div>
              <div
                *ngFor="let achievementsContainer of achievements"
                class="achievements-container"
              >
                <div class="achievements-category-title">
                  {{ achievementsContainer.category }}
                </div>
                <div class="achievements-icons">
                  <ng-container
                    *ngFor="
                      let achievement of achievementsContainer.achievements
                    "
                  >
                    <ng-container
                      *ngIf="achievement.icon"
                      class="achievement-icon"
                      >{{ achievement.icon }}</ng-container
                    >
                    <mat-icon *ngIf="!achievement.icon" class="achievement-icon"
                      >home</mat-icon
                    >
                  </ng-container>
                </div>
              </div>
            </div>
          </div>
        </mat-cell>
      </ng-container>

      <mat-header-row
        *matHeaderRowDef="displayedColumns; sticky: true"
      ></mat-header-row>
      <mat-row
        *matRowDef="let element; columns: displayedColumns"
        class="element-row"
        [class.expanded-row]="expandedElement === element"
        (click)="expandedElement = expandedElement === element ? null : element"
      >
      </mat-row>
      <mat-row
        *matRowDef="let row; columns: ['expandedDetail']"
        class="detail-row"
      ></mat-row>
    </mat-table>

    <mat-paginator
      *ngIf="paginatorU.length > 5"
      (page)="syncPrimaryPaginator($event)"
      [length]="paginatorU.length"
      [pageIndex]="paginatorU.pageIndex"
      [pageSize]="paginatorU.pageSize"
      [pageSizeOptions]="paginatorU.pageSizeOptions"
      showFirstLastButtons
    ></mat-paginator>
  </mat-card-content>
</mat-card>

<ng-template #achievementsUnlockedCellTemplate>
  <mat-progress-bar mode="determinate" value="40"></mat-progress-bar>
</ng-template>
